{% extends 'base.html' %} {% load static %} {% block title %}Expense
Management{% endblock %} {% block content %}
<div id="wrapper" class="wrapper bg-ash">
  {% include 'includes/header.html' %}

  <div class="dashboard-page-one">
    {% include 'includes/sidebar.html' %}
    <div class="dashboard-content-one">
      <!-- Breadcubs Area Start Here -->
      <div class="breadcrumbs-area">
        <h3>Expense Management</h3>
        <ul>
          <li>
            <a href="{% url 'dashboard' %}">Home</a>
          </li>
          <li>Expense Management</li>
        </ul>
      </div>
      <!-- Breadcubs Area End Here -->

      <!-- Add Expense Area Start Here -->
      <div class="card height-auto">
        <div class="card-body">
          <div class="heading-layout1">
            <div class="item-title">
              <h3>Add New Expense</h3>
            </div>
            <div class="dropdown">
              <a
                class="dropdown-toggle"
                href="#"
                role="button"
                data-toggle="dropdown"
                aria-expanded="false"
                >...</a
              >

              <div class="dropdown-menu dropdown-menu-right">
                <a class="dropdown-item" href="#"
                  ><i class="fas fa-times text-orange-red"></i>Close</a
                >
                <a class="dropdown-item" href="#"
                  ><i class="fas fa-cogs text-dark-pastel-green"></i>Edit</a
                >
                <a class="dropdown-item" href="#"
                  ><i class="fas fa-redo-alt text-orange-peel"></i>Refresh</a
                >
              </div>
            </div>
          </div>
          <form
            class="new-added-form"
            method="POST"
            action="{% url 'add_expense' %}"
          >
            {% csrf_token %}
            <div class="row">
              <div class="col-xl-3 col-lg-6 col-12 form-group">
                <label>Name *</label>
                <input
                  type="text"
                  name="name"
                  placeholder=""
                  class="form-control"
                  required
                />
              </div>
              <div class="col-xl-3 col-lg-6 col-12 form-group">
                <label>ID No *</label>
                <input
                  type="text"
                  name="expense_id"
                  placeholder=""
                  class="form-control"
                  required
                />
              </div>
              <div class="col-xl-3 col-lg-6 col-12 form-group">
                <label>Expense Type *</label>
                <select class="select2" name="expense_type" required>
                  <option value="">Please Select</option>
                  <option value="salary">Salary</option>
                  <option value="transport">Transport</option>
                  <option value="maintenance">Maintenance</option>
                  <option value="purchase">Purchase</option>
                  <option value="utilities">Utilities</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="col-xl-3 col-lg-6 col-12 form-group">
                <label>Amount *</label>
                <input
                  type="number"
                  name="amount"
                  step="0.01"
                  placeholder=""
                  class="form-control"
                  required
                />
              </div>
              <div class="col-xl-3 col-lg-6 col-12 form-group">
                <label>Phone</label>
                <input
                  type="text"
                  name="phone"
                  placeholder=""
                  class="form-control"
                />
              </div>
              <div class="col-xl-3 col-lg-6 col-12 form-group">
                <label>E-Mail Address</label>
                <input
                  type="email"
                  name="email"
                  placeholder=""
                  class="form-control"
                />
              </div>
              <div class="col-xl-3 col-lg-6 col-12 form-group">
                <label>Status</label>
                <select class="select2" name="status">
                  <option value="pending">Pending</option>
                  <option value="paid">Paid</option>
                  <option value="due">Due</option>
                  <option value="others">Others</option>
                </select>
              </div>
              <div class="col-xl-3 col-lg-6 col-12 form-group">
                <label>Date</label>
                <input
                  type="date"
                  name="date"
                  class="form-control"
                  value="{% now 'Y-m-d' %}"
                />
              </div>
              <div class="col-12 form-group">
                <label>Description</label>
                <textarea
                  name="description"
                  class="textarea form-control"
                  rows="4"
                ></textarea>
              </div>
              <div class="col-12 form-group mg-t-8">
                <button
                  type="submit"
                  class="btn-fill-lg btn-gradient-yellow btn-hover-bluedark"
                >
                  Save
                </button>
                <button
                  type="reset"
                  class="btn-fill-lg bg-blue-dark btn-hover-yellow"
                >
                  Reset
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
      <!-- Add Expense Area End Here -->

      <!-- Expense List Area Start Here -->
      <div class="card height-auto">
        <div class="card-body">
          <div class="heading-layout1">
            <div class="item-title">
              <h3>All Expenses</h3>
            </div>
          </div>

          <!-- Filter Section -->
          <div class="row mb-4">
            <div class="col-md-3">
              <input
                type="text"
                id="searchExpense"
                class="form-control"
                placeholder="Search expenses..."
              />
            </div>
            <div class="col-md-3">
              <select class="form-control" id="filterStatus">
                <option value="">All Status</option>
                <option value="paid">Paid</option>
                <option value="pending">Pending</option>
                <option value="due">Due</option>
              </select>
            </div>
            <div class="col-md-3">
              <select class="form-control" id="filterType">
                <option value="">All Types</option>
                <option value="salary">Salary</option>
                <option value="transport">Transport</option>
                <option value="maintenance">Maintenance</option>
                <option value="purchase">Purchase</option>
                <option value="utilities">Utilities</option>
              </select>
            </div>
            <div class="col-md-3">
              <input type="date" class="form-control" id="filterDate" />
            </div>
          </div>

          <div class="table-responsive">
            <table class="table display data-table text-nowrap">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Amount</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for expense in expenses %}
                <tr>
                  <td>{{ expense.expense_id }}</td>
                  <td>{{ expense.name }}</td>
                  <td>
                    <span class="badge badge-light"
                      >{{ expense.get_expense_type_display }}</span
                    >
                  </td>
                  <td>Kes. {{ expense.amount|floatformat:2 }}</td>
                  <td>{{ expense.date|date:"M d, Y" }}</td>
                  <td>
                    <span class="badge badge-{{ expense.status_class }}">
                      {{ expense.get_status_display }}
                    </span>
                  </td>
                  <td>
                    <div class="dropdown">
                      <a
                        href="#"
                        class="dropdown-toggle"
                        data-toggle="dropdown"
                        aria-expanded="false"
                      >
                        <span class="flaticon-more-button-of-three-dots"></span>
                      </a>
                      <div class="dropdown-menu dropdown-menu-right">
                        <a
                          class="dropdown-item"
                          href="{% url 'edit_expense' expense.id %}"
                        >
                          <i class="fas fa-cogs text-dark-pastel-green"></i>Edit
                        </a>
                        <!-- NEW CODE (correct) -->
                        <a
                          class="dropdown-item"
                          href="{% url 'expense_detail' expense.id %}"
                        >
                          <i class="fas fa-eye text-dark-pastel-green"></i>View
                        </a>
                        <a
                          class="dropdown-item"
                          href="{% url 'delete_expense' expense.id %}"
                          onclick="return confirm('Are you sure you want to delete this expense?')"
                        >
                          <i class="fas fa-times text-orange-red"></i>Delete
                        </a>
                      </div>
                    </div>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="7" class="text-center">No expenses found</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          {% if expenses.has_other_pages %}
          <div class="pagination-wrap">
            <ul class="pagination">
              {% if expenses.has_previous %}
              <li class="page-item">
                <a
                  class="page-link"
                  href="?page={{ expenses.previous_page_number }}"
                  >Previous</a
                >
              </li>
              {% endif %} {% for i in expenses.paginator.page_range %}
              <li
                class="page-item {% if expenses.number == i %}active{% endif %}"
              >
                <a class="page-link" href="?page={{ i }}">{{ i }}</a>
              </li>
              {% endfor %} {% if expenses.has_next %}
              <li class="page-item">
                <a
                  class="page-link"
                  href="?page={{ expenses.next_page_number }}"
                  >Next</a
                >
              </li>
              {% endif %}
            </ul>
          </div>
          {% endif %}
        </div>
      </div>
      <!-- Expense List Area End Here -->
    </div>
  </div>
</div>

{% endblock %} {% block scripts %}
<script>
  // Filter functionality
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("searchExpense");
    const statusFilter = document.getElementById("filterStatus");
    const typeFilter = document.getElementById("filterType");
    const dateFilter = document.getElementById("filterDate");

    function filterExpenses() {
      const searchTerm = searchInput.value.toLowerCase();
      const statusValue = statusFilter.value;
      const typeValue = typeFilter.value;
      const dateValue = dateFilter.value;

      // Implement filtering logic here
      // This would typically make an AJAX call to the server
      console.log("Filtering expenses...");
    }

    searchInput.addEventListener("input", filterExpenses);
    statusFilter.addEventListener("change", filterExpenses);
    typeFilter.addEventListener("change", filterExpenses);
    dateFilter.addEventListener("change", filterExpenses);
  });
</script>
{% endblock %}
